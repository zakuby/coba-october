+function($){"use strict";void 0===$.oc.builder&&($.oc.builder={});var t=$.oc.foundation.base,e=t.prototype,o=function(){this.data={},this.requestCache={},this.callbackCache={},t.call(this)};o.prototype.set=function(t,e,o,i,r){this.storeData(t,e,o,i),"localization"!=e||o||this.localizationUpdated(t,r)},o.prototype.get=function(t,e,o,i,r){return void 0===this.data[e]||void 0===this.data[e][o]||void 0===this.data[e][o][i]||this.isCacheObsolete(this.data[e][o][i].timestamp)?this.loadDataFromServer(t,e,o,i,r):void r(this.data[e][o][i].data)},o.prototype.makeCacheKey=function(t,e,o){var i=t+"-"+e;return o&&(i+="-"+o),i},o.prototype.isCacheObsolete=function(t){return Date.now()-t>3e5},o.prototype.loadDataFromServer=function(t,e,o,i,r){var n=this,a=this.makeCacheKey(e,o,i);return void 0===this.requestCache[a]&&(this.requestCache[a]=t.request("onPluginDataRegistryGetData",{data:{registry_plugin_code:e,registry_data_type:o,registry_data_subtype:i}}).done(function(t){if(void 0===t.registryData)throw new Error("Invalid data registry response.");n.storeData(e,o,i,t.registryData),n.applyCallbacks(a,t.registryData),n.requestCache[a]=void 0})),this.addCallbackToQueue(r,a),this.requestCache[a]},o.prototype.addCallbackToQueue=function(t,e){void 0===this.callbackCache[e]&&(this.callbackCache[e]=[]),this.callbackCache[e].push(t)},o.prototype.applyCallbacks=function(t,e){if(void 0!==this.callbackCache[t]){for(var o=this.callbackCache[t].length-1;o>=0;o--)this.callbackCache[t][o](e);delete this.callbackCache[t]}},o.prototype.storeData=function(t,e,o,i){void 0===this.data[t]&&(this.data[t]={}),void 0===this.data[t][e]&&(this.data[t][e]={});var r={timestamp:Date.now(),data:i};this.data[t][e][o]=r},o.prototype.clearCache=function(t,e){void 0!==this.data[t]&&void 0!==this.data[t][e]&&(this.data[t][e]=void 0)},o.prototype.getLocalizationString=function(t,e,o,i){this.get(t,e,"localization",null,function(t){return void 0!==t[o]?void i(t[o]):void i(o)})},o.prototype.localizationUpdated=function(t,e){$.oc.builder.localizationInput.updatePluginInputs(t),void 0!==e&&e.suppressLanguageEditorUpdate||$.oc.builder.indexController.entityControllers.localization.languageUpdated(t),$.oc.builder.indexController.entityControllers.localization.updateOnScreenStrings(t)},$.oc.builder.dataRegistry=new o}(window.jQuery),+function($){"use strict";void 0===$.oc.builder&&($.oc.builder={}),void 0===$.oc.builder.entityControllers&&($.oc.builder.entityControllers={});var t=$.oc.foundation.base,e=t.prototype,o=function(e,o){if(void 0===e)throw new Error("The Builder entity type name should be set in the base constructor call.");if(void 0===o)throw new Error("The Builder index controller should be set when creating an entity controller.");this.typeName=e,this.indexController=o,t.call(this)};o.prototype=Object.create(e),o.prototype.constructor=o,o.prototype.registerHandlers=function(){},o.prototype.invokeCommand=function(t,e){if(!/^cmd[a-zA-Z0-9]+$/.test(t))throw new Error("Invalid command: "+t);if(void 0===this[t])throw new Error("Unknown command: "+t);this[t].apply(this,[e])},o.prototype.newTabId=function(){return this.typeName+Math.random()},o.prototype.makeTabId=function(t){return this.typeName+"-"+t},o.prototype.getMasterTabsActivePane=function(){return this.indexController.getMasterTabActivePane()},o.prototype.getMasterTabsObject=function(){return this.indexController.masterTabsObj},o.prototype.getSelectedPlugin=function(){var t=$("#PluginList-pluginList-plugin-list > ul > li.active");return t.data("id")},o.prototype.getIndexController=function(){return this.indexController},o.prototype.updateMasterTabIdAndTitle=function(t,e){var o=this.getMasterTabsObject();o.updateIdentifier(t,e.tabId),o.updateTitle(t,e.tabTitle)},o.prototype.unhideFormDeleteButton=function(t){$("[data-control=delete-button]",t).removeClass("hide")},o.prototype.forceCloseTab=function(t){t.trigger("close.oc.tab",[{force:!0}])},o.prototype.unmodifyTab=function(t){this.indexController.unchangeTab(t)},$.oc.builder.entityControllers.base=o}(window.jQuery),+function($){"use strict";void 0===$.oc.builder&&($.oc.builder={}),void 0===$.oc.builder.entityControllers&&($.oc.builder.entityControllers={});var t=$.oc.builder.entityControllers.base,e=t.prototype,o=function(e){t.call(this,"plugin",e),this.popupZIndex=5050};o.prototype=Object.create(e),o.prototype.constructor=o,o.prototype.cmdMakePluginActive=function(t){var e=$(t.currentTarget),o=e.data("pluginCode");this.makePluginActive(o)},o.prototype.cmdCreatePlugin=function(t){var e=$(t.currentTarget);e.one("shown.oc.popup",this.proxy(this.onPluginPopupShown)),e.popup({handler:"onPluginLoadPopup",zIndex:this.popupZIndex})},o.prototype.cmdApplyPluginSettings=function(t){var e=$(t.currentTarget),o=this;$.oc.stripeLoadIndicator.show(),e.request("onPluginSave").always($.oc.builder.indexController.hideStripeIndicatorProxy).done(function(t){e.trigger("close.oc.popup"),o.applyPluginSettingsDone(t)})},o.prototype.cmdEditPluginSettings=function(t){var e=$(t.currentTarget);e.one("shown.oc.popup",this.proxy(this.onPluginPopupShown)),e.popup({handler:"onPluginLoadPopup",zIndex:this.popupZIndex,extraData:{pluginCode:e.data("pluginCode")}})},o.prototype.onPluginPopupShown=function(t,e,o){$(o).find("input[name=name]").focus()},o.prototype.applyPluginSettingsDone=function(t){void 0!==t.responseData&&void 0!==t.responseData.isNewPlugin&&this.makePluginActive(t.responseData.pluginCode,!0)},o.prototype.makePluginActive=function(t,e){var o=$("#builder-plugin-selector-panel form").first();$.oc.stripeLoadIndicator.show(),o.request("onPluginSetActive",{data:{pluginCode:t,updatePluginList:e?1:0}}).always($.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.makePluginActiveDone))},o.prototype.makePluginActiveDone=function(t){var e=t.responseData.pluginCode;$("#builder-plugin-selector-panel [data-control=filelist]").fileList("markActive",e)},$.oc.builder.entityControllers.plugin=o}(window.jQuery),+function($){"use strict";void 0===$.oc.builder&&($.oc.builder={}),void 0===$.oc.builder.entityControllers&&($.oc.builder.entityControllers={});var t=$.oc.builder.entityControllers.base,e=t.prototype,o=function(e){t.call(this,"databaseTable",e)};o.prototype=Object.create(e),o.prototype.constructor=o,o.prototype.cmdCreateTable=function(t){var e=this.indexController.openOrLoadMasterTab($(t.target),"onDatabaseTableCreateOrOpen",this.newTabId());e!==!1&&e.done(this.proxy(this.onTableLoaded,this))},o.prototype.cmdOpenTable=function(t){var e=$(t.currentTarget).data("id"),o=this.indexController.openOrLoadMasterTab($(t.target),"onDatabaseTableCreateOrOpen",this.makeTabId(e),{table_name:e});o!==!1&&o.done(this.proxy(this.onTableLoaded,this))},o.prototype.cmdSaveTable=function(t){var e=$(t.currentTarget);if(this.validateTable(e)){var o={columns:this.getTableData(e)};e.popup({extraData:o,handler:"onDatabaseTableValidateAndShowPopup"})}},o.prototype.cmdSaveMigration=function(t){var e=$(t.currentTarget);$.oc.stripeLoadIndicator.show(),e.request("onDatabaseTableMigrationApply").always($.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.saveMigrationDone))},o.prototype.cmdDeleteTable=function(t){var e=$(t.currentTarget);$.oc.confirm(e.data("confirm"),this.proxy(this.deleteConfirmed))},o.prototype.cmdUnModifyForm=function(){var t=this.getMasterTabsActivePane();this.unmodifyTab(t)},o.prototype.cmdAddTimestamps=function(t){var e=$(t.currentTarget),o=this.addTimeStampColumns(e,["created_at","updated_at"]);o||alert(e.closest("form").attr("data-lang-timestamps-exist"))},o.prototype.cmdAddSoftDelete=function(t){var e=$(t.currentTarget),o=this.addTimeStampColumns(e,["deleted_at"]);o||alert(e.closest("form").attr("data-lang-soft-deleting-exist"))},o.prototype.onTableCellChanged=function(t,e,o,i){var r=$(t.target);if("columns"==r.data("alias")&&"database"==r.closest("form").data("entity")){var n={};"auto_increment"==e&&o&&(n.unsigned=1,n.primary_key=1),"unsigned"!=e||o||(n.auto_increment=0),"primary_key"==e&&o&&(n.allow_null=0),"allow_null"==e&&o&&(n.primary_key=0),"primary_key"!=e||o||(n.auto_increment=0),r.table("setRowValues",i,n)}},o.prototype.onTableLoaded=function(){$(document).trigger("render");var t=this.getMasterTabsActivePane(),e=t.find("form"),o=t.find("div[data-control=table] div.toolbar"),i=$('<a class="btn oc-icon-clock-o builder-custom-table-button" data-builder-command="databaseTable:cmdAddTimestamps"></a>');i.text(e.attr("data-lang-add-timestamps")),o.append(i),i=$('<a class="btn oc-icon-refresh builder-custom-table-button" data-builder-command="databaseTable:cmdAddSoftDelete"></a>'),i.text(e.attr("data-lang-add-soft-delete")),o.append(i)},o.prototype.registerHandlers=function(){this.indexController.$masterTabs.on("oc.tableCellChanged",this.proxy(this.onTableCellChanged))},o.prototype.validateTable=function(t){var e=this.getTableControlObject(t);return e.unfocusTable(),e.validate()},o.prototype.getTableData=function(t){var e=this.getTableControlObject(t);return e.dataSource.getAllData()},o.prototype.getTableControlObject=function(t){var e=t.closest("form"),o=e.find("[data-control=table]"),i=o.data("oc.table");if(!i)throw new Error("Table object is not found on the database table tab");return i},o.prototype.saveMigrationDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");$("#builderTableMigrationPopup").trigger("close.oc.popup");var e=this.getMasterTabsActivePane(),o=this.getMasterTabsObject();"delete"!=t.builderResponseData.operation?(e.find("input[name=table_name]").val(t.builderResponseData.builderObjectName),this.updateMasterTabIdAndTitle(e,t.builderResponseData),this.unhideFormDeleteButton(e),this.getTableList().fileList("markActive",t.builderResponseData.tabId),this.getIndexController().unchangeTab(e)):this.forceCloseTab(e),$.oc.builder.dataRegistry.clearCache(t.builderResponseData.pluginCode,"model-columns")},o.prototype.getTableList=function(){return $("#layout-side-panel form[data-content-id=database] [data-control=filelist]")},o.prototype.deleteConfirmed=function(){var t=this.getMasterTabsActivePane();t.find("form").popup({handler:"onDatabaseTableShowDeletePopup"})},o.prototype.getColumnNames=function(t){var e=this.getTableControlObject(t);e.unfocusTable();var o=this.getTableData(t),i=[];for(var r in o)void 0!==o[r].name&&i.push($.trim(o[r].name));return i},o.prototype.addTimeStampColumns=function(t,e){var o=this.getColumnNames(t),i=!1;for(var r in e){var n=e[r];-1==$.inArray(n,o)&&(this.addTimeStampColumn(t,n),i=!0)}return i&&t.trigger("change"),i},o.prototype.addTimeStampColumn=function(t,e){var o=this.getTableControlObject(t),i=this.getTableData(t),r={name:e,type:"timestamp","default":null,allow_null:!0};o.addRecord("bottom",!0),o.setRowValues(i.length-1,r),o.addRecord("bottom",!1),o.deleteRecord()},$.oc.builder.entityControllers.databaseTable=o}(window.jQuery),+function($){"use strict";void 0===$.oc.builder&&($.oc.builder={}),void 0===$.oc.builder.entityControllers&&($.oc.builder.entityControllers={});var t=$.oc.builder.entityControllers.base,e=t.prototype,o=function(e){t.call(this,"model",e)};o.prototype=Object.create(e),o.prototype.constructor=o,o.prototype.cmdCreateModel=function(t){var e=$(t.currentTarget);e.one("shown.oc.popup",this.proxy(this.onModelPopupShown)),e.popup({handler:"onModelLoadPopup"})},o.prototype.cmdApplyModelSettings=function(t){var e=$(t.currentTarget),o=this;$.oc.stripeLoadIndicator.show(),e.request("onModelSave").always($.oc.builder.indexController.hideStripeIndicatorProxy).done(function(t){e.trigger("close.oc.popup"),o.applyModelSettingsDone(t)})},o.prototype.onModelPopupShown=function(t,e,o){$(o).find("input[name=className]").focus()},o.prototype.applyModelSettingsDone=function(t){if(void 0!==t.builderResponseData.registryData){var e=t.builderResponseData.registryData;$.oc.builder.dataRegistry.set(e.pluginCode,"model-classes",null,e.models)}},$.oc.builder.entityControllers.model=o}(window.jQuery),+function($){"use strict";void 0===$.oc.builder&&($.oc.builder={}),void 0===$.oc.builder.entityControllers&&($.oc.builder.entityControllers={});var t=$.oc.builder.entityControllers.base,e=t.prototype,o=function(e){t.call(this,"modelForm",e)};o.prototype=Object.create(e),o.prototype.constructor=o,o.prototype.cmdCreateForm=function(t){var e=$(t.currentTarget),o={model_class:e.data("modelClass")};this.indexController.openOrLoadMasterTab(e,"onModelFormCreateOrOpen",this.newTabId(),o)},o.prototype.cmdSaveForm=function(t){var e=$(t.currentTarget),o=e.closest("form"),i=$("[data-root-control-wrapper] > [data-control-container]",o),r=o.find(".inspector-container"),n=$.oc.builder.formbuilder.domToPropertyJson.convert(i.get(0));if($.oc.inspector.manager.applyValuesFromContainer(r)){if(n===!1)return void $.oc.flashMsg({text:$.oc.builder.formbuilder.domToPropertyJson.getLastError(),"class":"error",interval:5});var a={controls:n};e.request("onModelFormSave",{data:a}).done(this.proxy(this.saveFormDone))}},o.prototype.cmdOpenForm=function(t){var e=$(t.currentTarget).data("form"),o=$(t.currentTarget).data("modelClass");this.indexController.openOrLoadMasterTab($(t.target),"onModelFormCreateOrOpen",this.makeTabId(o+"-"+e),{file_name:e,model_class:o})},o.prototype.cmdDeleteForm=function(t){var e=$(t.currentTarget);$.oc.confirm(e.data("confirm"),this.proxy(this.deleteConfirmed))},o.prototype.cmdAddControl=function(t){$.oc.builder.formbuilder.controlPalette.addControl(t)},o.prototype.cmdUndockControlPalette=function(t){$.oc.builder.formbuilder.controlPalette.undockFromContainer(t)},o.prototype.cmdDockControlPalette=function(t){$.oc.builder.formbuilder.controlPalette.dockToContainer(t)},o.prototype.cmdCloseControlPalette=function(t){$.oc.builder.formbuilder.controlPalette.closeInContainer(t)},o.prototype.saveFormDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();e.find("input[name=file_name]").val(t.builderResponseData.builderObjectName),this.updateMasterTabIdAndTitle(e,t.builderResponseData),this.unhideFormDeleteButton(e),this.getModelList().fileList("markActive",t.builderResponseData.tabId),this.getIndexController().unchangeTab(e),this.updateDataRegistry(t)},o.prototype.updateDataRegistry=function(t){if(void 0!==t.builderResponseData.registryData){var e=t.builderResponseData.registryData;$.oc.builder.dataRegistry.set(e.pluginCode,"model-forms",e.modelClass,e.forms)}},o.prototype.deleteConfirmed=function(){var t=this.getMasterTabsActivePane(),e=t.find("form");$.oc.stripeLoadIndicator.show(),e.request("onModelFormDelete").always($.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))},o.prototype.deleteDone=function(t){var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e),this.forceCloseTab(e),this.updateDataRegistry(t)},o.prototype.getModelList=function(){return $("#layout-side-panel form[data-content-id=models] [data-control=filelist]")},$.oc.builder.entityControllers.modelForm=o}(window.jQuery),+function($){"use strict";void 0===$.oc.builder&&($.oc.builder={}),void 0===$.oc.builder.entityControllers&&($.oc.builder.entityControllers={});var t=$.oc.builder.entityControllers.base,e=t.prototype,o=function(e){this.cachedModelFieldsPromises={},t.call(this,"modelList",e)};o.prototype=Object.create(e),o.prototype.constructor=o,o.prototype.registerHandlers=function(){$(document).on("autocompleteitems.oc.table",'form[data-sub-entity="model-list"] [data-control=table]',this.proxy(this.onAutocompleteItems))},o.prototype.cmdCreateList=function(t){var e=$(t.currentTarget),o={model_class:e.data("modelClass")};this.indexController.openOrLoadMasterTab(e,"onModelListCreateOrOpen",this.newTabId(),o)},o.prototype.cmdSaveList=function(t){var e=$(t.currentTarget),o=e.closest("form");this.validateTable(e)&&e.request("onModelListSave",{data:{columns:this.getTableData(e)}}).done(this.proxy(this.saveListDone))},o.prototype.cmdOpenList=function(t){var e=$(t.currentTarget).data("list"),o=$(t.currentTarget).data("modelClass");this.indexController.openOrLoadMasterTab($(t.target),"onModelListCreateOrOpen",this.makeTabId(o+"-"+e),{file_name:e,model_class:o})},o.prototype.cmdDeleteList=function(t){var e=$(t.currentTarget);$.oc.confirm(e.data("confirm"),this.proxy(this.deleteConfirmed))},o.prototype.saveListDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();e.find("input[name=file_name]").val(t.builderResponseData.builderObjectName),this.updateMasterTabIdAndTitle(e,t.builderResponseData),this.unhideFormDeleteButton(e),this.getModelList().fileList("markActive",t.builderResponseData.tabId),this.getIndexController().unchangeTab(e),this.updateDataRegistry(t)},o.prototype.deleteConfirmed=function(){var t=this.getMasterTabsActivePane(),e=t.find("form");$.oc.stripeLoadIndicator.show(),e.request("onModelListDelete").always($.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))},o.prototype.deleteDone=function(t){var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e),this.forceCloseTab(e),this.updateDataRegistry(t)},o.prototype.getTableControlObject=function(t){var e=t.closest("form"),o=e.find("[data-control=table]"),i=o.data("oc.table");if(!i)throw new Error("Table object is not found on the model list tab");return i},o.prototype.getModelList=function(){return $("#layout-side-panel form[data-content-id=models] [data-control=filelist]")},o.prototype.validateTable=function(t){var e=this.getTableControlObject(t);return e.unfocusTable(),e.validate()},o.prototype.getTableData=function(t){var e=this.getTableControlObject(t);return e.dataSource.getAllData()},o.prototype.loadModelFields=function(t,e){var o=$(t).closest("form"),i=o.find("input[name=model_class]").val(),r=o.data("oc.model-field-cache");return void 0!==r?void e(r):(void 0===this.cachedModelFieldsPromises[i]&&(this.cachedModelFieldsPromises[i]=o.request("onModelFormGetModelFields",{data:{as_plain_list:1}})),void(void 0!==e&&this.cachedModelFieldsPromises[i].done(function(t){o.data("oc.model-field-cache",t.responseData.options),e(t.responseData.options)})))},o.prototype.updateDataRegistry=function(t){if(void 0!==t.builderResponseData.registryData){var e=t.builderResponseData.registryData;$.oc.builder.dataRegistry.set(e.pluginCode,"model-lists",e.modelClass,e.lists),$.oc.builder.dataRegistry.clearCache(e.pluginCode,"plugin-lists")}},o.prototype.onAutocompleteItems=function(t,e){return"model-fields"===e.columnConfiguration.fillFrom?(t.preventDefault(),this.loadModelFields(t.target,e.callback),!1):void 0},$.oc.builder.entityControllers.modelList=o}(window.jQuery),+function($){"use strict";void 0===$.oc.builder&&($.oc.builder={}),void 0===$.oc.builder.entityControllers&&($.oc.builder.entityControllers={});var t=$.oc.builder.entityControllers.base,e=t.prototype,o=function(e){t.call(this,"permissions",e)};o.prototype=Object.create(e),o.prototype.constructor=o,o.prototype.registerHandlers=function(){this.indexController.$masterTabs.on("oc.tableNewRow",this.proxy(this.onTableRowCreated))},o.prototype.cmdOpenPermissions=function(t){var e=this.getSelectedPlugin();return e?void this.indexController.openOrLoadMasterTab($(t.target),"onPermissionsOpen",this.makeTabId(e)):void alert("Please select a plugin first")},o.prototype.cmdSavePermissions=function(t){var e=$(t.currentTarget),o=e.closest("form");this.validateTable(e)&&e.request("onPermissionsSave",{data:{permissions:this.getTableData(e)}}).done(this.proxy(this.savePermissionsDone))},o.prototype.getTableControlObject=function(t){var e=t.closest("form"),o=e.find("[data-control=table]"),i=o.data("oc.table");if(!i)throw new Error("Table object is not found on permissions tab");return i},o.prototype.validateTable=function(t){var e=this.getTableControlObject(t);return e.unfocusTable(),e.validate()},o.prototype.getTableData=function(t){var e=this.getTableControlObject(t);return e.dataSource.getAllData()},o.prototype.savePermissionsDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e),$.oc.builder.dataRegistry.clearCache(t.builderResponseData.pluginCode,"permissions")},o.prototype.onTableRowCreated=function(t,e){var o=$(t.target);if("permissions"==o.data("alias")){var i=o.closest("form");if("permissions"==i.data("entity")){var r=i.find("input[name=plugin_code]").val();e.permission=r.toLowerCase()+"."}}},$.oc.builder.entityControllers.permission=o}(window.jQuery),+function($){"use strict";void 0===$.oc.builder&&($.oc.builder={}),void 0===$.oc.builder.entityControllers&&($.oc.builder.entityControllers={});var t=$.oc.builder.entityControllers.base,e=t.prototype,o=function(e){t.call(this,"menus",e)};o.prototype=Object.create(e),o.prototype.constructor=o,o.prototype.cmdOpenMenus=function(t){var e=this.getSelectedPlugin();return e?void this.indexController.openOrLoadMasterTab($(t.target),"onMenusOpen",this.makeTabId(e)):void alert("Please select a plugin first")},o.prototype.cmdSaveMenus=function(t){var e=$(t.currentTarget),o=e.closest("form"),i=o.find(".inspector-container");if($.oc.inspector.manager.applyValuesFromContainer(i)){var r=$.oc.builder.menubuilder.controller.getJson(o.get(0));e.request("onMenusSave",{data:{menus:r}}).done(this.proxy(this.saveMenusDone))}},o.prototype.cmdAddMainMenuItem=function(t){$.oc.builder.menubuilder.controller.addMainMenuItem(t)},o.prototype.cmdAddSideMenuItem=function(t){$.oc.builder.menubuilder.controller.addSideMenuItem(t)},o.prototype.cmdDeleteMenuItem=function(t){$.oc.builder.menubuilder.controller.deleteMenuItem(t)},o.prototype.saveMenusDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e)},$.oc.builder.entityControllers.menus=o}(window.jQuery),+function($){"use strict";void 0===$.oc.builder&&($.oc.builder={}),void 0===$.oc.builder.entityControllers&&($.oc.builder.entityControllers={});var t=$.oc.builder.entityControllers.base,e=t.prototype,o=function(e){t.call(this,"version",e),this.hiddenHints={}};o.prototype=Object.create(e),o.prototype.constructor=o,o.prototype.cmdCreateVersion=function(t){var e=$(t.currentTarget),o=e.data("versionType");this.indexController.openOrLoadMasterTab(e,"onVersionCreateOrOpen",this.newTabId(),{version_type:o})},o.prototype.cmdSaveVersion=function(t){var e=$(t.currentTarget),o=e.closest("form");e.request("onVersionSave").done(this.proxy(this.saveVersionDone))},o.prototype.cmdOpenVersion=function(t){var e=$(t.currentTarget).data("id"),o=$(t.currentTarget).data("pluginCode");this.indexController.openOrLoadMasterTab($(t.target),"onVersionCreateOrOpen",this.makeTabId(o+"-"+e),{original_version:e})},o.prototype.cmdDeleteVersion=function(t){var e=$(t.currentTarget);$.oc.confirm(e.data("confirm"),this.proxy(this.deleteConfirmed))},o.prototype.cmdApplyVersion=function(t){var e=$(t.currentTarget),o=e.closest("div.tab-pane"),i=this;this.showHintPopup(o,"builder-version-apply",function(){e.request("onVersionApply").done(i.proxy(i.applyVersionDone))})},o.prototype.cmdRollbackVersion=function(t){var e=$(t.currentTarget),o=e.closest("div.tab-pane"),i=this;this.showHintPopup(o,"builder-version-rollback",function(){e.request("onVersionRollback").done(i.proxy(i.rollbackVersionDone))})},o.prototype.saveVersionDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();this.updateUiAfterSave(e,t),t.builderResponseData.isApplied||this.showSavedNotAppliedHint(e)},o.prototype.showSavedNotAppliedHint=function(t){this.showHintPopup(t,"builder-version-save-unapplied")},o.prototype.showHintPopup=function(t,e,o){return this.getDontShowHintAgain(e,t)?void(o&&o.apply(this)):(t.one("hide.oc.popup",this.proxy(this.onHintPopupHide)),o&&t.one("shown.oc.popup",function(t,e,i){i.find("form").one("submit",function(t){return o.apply(this),t.preventDefault(),$(t.target).trigger("close.oc.popup"),!1})}),void t.popup({content:this.getPopupContent(t,e)}))},o.prototype.onHintPopupHide=function(t,e,o){var i=o.find("input[type=checkbox][name=dont_show_again]").is(":checked"),r=o.find("input[type=hidden][name=hint_code]").val();if(o.find("form").off("submit"),i){var n=this.getMasterTabsActivePane().find('form[data-entity="versions"]');n.request("onHideBackendHint",{data:{name:r}}),this.setDontShowHintAgain(r)}},o.prototype.setDontShowHintAgain=function(t){this.hiddenHints[t]=!0},o.prototype.getDontShowHintAgain=function(t,e){return void 0!==this.hiddenHints[t]?this.hiddenHints[t]:"true"==e.find('input[type=hidden][data-hint-hidden="'+t+'"]').val()},o.prototype.getPopupContent=function(t,e){var o=t.find('script[data-version-hint-template="'+e+'"]');if(0===o.length)throw new Error("Version popup template not found: "+e);return o.html()},o.prototype.updateUiAfterSave=function(t,e){t.find("input[name=original_version]").val(e.builderResponseData.savedVersion),this.updateMasterTabIdAndTitle(t,e.builderResponseData),this.unhideFormDeleteButton(t),this.getVersionList().fileList("markActive",e.builderResponseData.tabId),this.getIndexController().unchangeTab(t)},o.prototype.deleteConfirmed=function(){var t=this.getMasterTabsActivePane(),e=t.find("form");$.oc.stripeLoadIndicator.show(),e.request("onVersionDelete").always($.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))},o.prototype.deleteDone=function(){var t=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(t),this.forceCloseTab(t)},o.prototype.applyVersionDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();this.updateUiAfterSave(e,t),this.updateVersionsButtons()},o.prototype.rollbackVersionDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();this.updateUiAfterSave(e,t),this.updateVersionsButtons()},o.prototype.getVersionList=function(){return $("#layout-side-panel form[data-content-id=version] [data-control=filelist]")},o.prototype.updateVersionsButtons=function(){for(var t=this.getMasterTabsObject(),e=t.$tabsContainer.find("> li"),o=this.getVersionList(),i=e.length-1;i>=0;i--){var r=$(e[i]),n=r.data("tabId");if(n&&0!=String(n).length){var a=o.find('li[data-id="'+n+'"]');if(a.length){var s=a.data("applied"),l=t.findPaneFromTab(r);s?(l.find('[data-builder-command="version:cmdApplyVersion"]').addClass("hide"),l.find('[data-builder-command="version:cmdRollbackVersion"]').removeClass("hide")):(l.find('[data-builder-command="version:cmdApplyVersion"]').removeClass("hide"),l.find('[data-builder-command="version:cmdRollbackVersion"]').addClass("hide"))}}}},$.oc.builder.entityControllers.version=o}(window.jQuery),+function($){"use strict";void 0===$.oc.builder&&($.oc.builder={}),void 0===$.oc.builder.entityControllers&&($.oc.builder.entityControllers={});var t=$.oc.builder.entityControllers.base,e=t.prototype,o=function(e){t.call(this,"localization",e)};o.prototype=Object.create(e),o.prototype.constructor=o,o.prototype.cmdCreateLanguage=function(t){this.indexController.openOrLoadMasterTab($(t.target),"onLanguageCreateOrOpen",this.newTabId())},o.prototype.cmdOpenLanguage=function(t){var e=$(t.currentTarget).data("id"),o=$(t.currentTarget).data("pluginCode");this.indexController.openOrLoadMasterTab($(t.target),"onLanguageCreateOrOpen",this.makeTabId(o+"-"+e),{original_language:e})},o.prototype.cmdSaveLanguage=function(t){var e=$(t.currentTarget),o=e.closest("form");e.request("onLanguageSave").done(this.proxy(this.saveLanguageDone))},o.prototype.cmdDeleteLanguage=function(t){var e=$(t.currentTarget);$.oc.confirm(e.data("confirm"),this.proxy(this.deleteConfirmed))},o.prototype.cmdCopyMissingStrings=function(t){var e=$(t.currentTarget),o=e.find("select[name=language]").val(),i=this.getMasterTabsActivePane();e.trigger("close.oc.popup"),$.oc.stripeLoadIndicator.show(),i.find("form").request("onLanguageCopyStringsFrom",{data:{copy_from:o}}).always($.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.copyStringsFromDone))},o.prototype.languageUpdated=function(t){var e=this.findDefaultLanguageForm(t);if(e){var o=$(e);o.hasClass("oc-data-changed")?this.mergeLanguageFromServer(o):this.updateLanguageFromServer(o)}},o.prototype.updateOnScreenStrings=function(t){var e=document.body.querySelectorAll('span[data-localization-key][data-plugin="'+t+'"]');$.oc.builder.dataRegistry.get($("#builder-plugin-selector-panel form"),t,"localization",null,function(t){for(var o=e.length-1;o>=0;o--){var i=e[o],r=i.getAttribute("data-localization-key");void 0!==t[r]?i.textContent=t[r]:i.textContent=r}})},o.prototype.saveLanguageDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();if(e.find("input[name=original_language]").val(t.builderResponseData.language),this.updateMasterTabIdAndTitle(e,t.builderResponseData),this.unhideFormDeleteButton(e),this.getLanguageList().fileList("markActive",t.builderResponseData.tabId),this.getIndexController().unchangeTab(e),void 0!==t.builderResponseData.registryData){var o=t.builderResponseData.registryData;$.oc.builder.dataRegistry.set(o.pluginCode,"localization",null,o.strings,{suppressLanguageEditorUpdate:!0}),$.oc.builder.dataRegistry.set(o.pluginCode,"localization","sections",o.sections)}},o.prototype.getLanguageList=function(){return $("#layout-side-panel form[data-content-id=localization] [data-control=filelist]")},o.prototype.getCodeEditor=function(t){return t.find("div[data-field-name=strings] div[data-control=codeeditor]").data("oc.codeEditor").editor},o.prototype.deleteConfirmed=function(){var t=this.getMasterTabsActivePane(),e=t.find("form");$.oc.stripeLoadIndicator.show(),e.request("onLanguageDelete").always($.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))},o.prototype.deleteDone=function(){var t=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(t),this.forceCloseTab(t)},o.prototype.copyStringsFromDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=t.builderResponseData,o=this.getMasterTabsActivePane(),i=o.find("form"),r=this.getCodeEditor(o),n=i.data("newStringMessage"),a=i.data("structureMismatch");r.getSession().setValue(e.strings);for(var s=[],l=e.updatedLines.length-1;l>=0;l--){var d=e.updatedLines[l];s.push({row:d,column:0,text:n,type:"warning"})}r.getSession().setAnnotations(s),e.mismatch&&$.oc.alert(a)},o.prototype.findDefaultLanguageForm=function(t){for(var e=document.body.querySelectorAll("form[data-entity=localization]"),o=e.length-1;o>=0;o--){var i=e[o],r=i.querySelector("input[name=plugin_code]"),n=i.querySelector("input[name=original_language]");if(r&&r.value==t&&n&&i.getAttribute("data-default-language")==n.value)return i}return null},o.prototype.updateLanguageFromServer=function(t){var e=this;t.request("onLanguageGetStrings").done(function(o){e.updateLanguageFromServerDone(t,o)})},o.prototype.updateLanguageFromServerDone=function(t,e){if(void 0===e.builderResponseData)throw new Error("Invalid response data");var o=e.builderResponseData,i=t.closest(".tab-pane"),r=this.getCodeEditor(i);o.strings&&(r.getSession().setValue(o.strings),this.unmodifyTab(i))},o.prototype.mergeLanguageFromServer=function(t){var e=t.find("input[name=original_language]").val(),o=this;t.request("onLanguageCopyStringsFrom",{data:{copy_from:e}}).done(function(e){o.mergeLanguageFromServerDone(t,e)})},o.prototype.mergeLanguageFromServerDone=function(t,e){if(void 0===e.builderResponseData)throw new Error("Invalid response data");var o=e.builderResponseData,i=t.closest(".tab-pane"),r=this.getCodeEditor(i);r.getSession().setValue(o.strings),r.getSession().setAnnotations([])},$.oc.builder.entityControllers.localization=o;
}(window.jQuery),+function($){"use strict";void 0===$.oc.builder&&($.oc.builder={}),void 0===$.oc.builder.entityControllers&&($.oc.builder.entityControllers={});var t=$.oc.builder.entityControllers.base,e=t.prototype,o=function(e){t.call(this,"controller",e)};o.prototype=Object.create(e),o.prototype.constructor=o,o.prototype.cmdCreateController=function(t){var e=$(t.currentTarget),o=this,i=e.data("pluginCode"),r=e.find('input[name="behaviors[]"]:checked').length,n=null;n=r?this.indexController.openOrLoadMasterTab(e,"onControllerCreate",this.makeTabId(i+"-new-controller"),{}):e.request("onControllerCreate"),n.done(function(t){e.trigger("close.oc.popup"),o.updateDataRegistry(t)}).always($.oc.builder.indexController.hideStripeIndicatorProxy)},o.prototype.cmdOpenController=function(t){var e=$(t.currentTarget).data("id"),o=$(t.currentTarget).data("pluginCode");this.indexController.openOrLoadMasterTab($(t.target),"onControllerOpen",this.makeTabId(o+"-"+e),{controller:e})},o.prototype.cmdSaveController=function(t){var e=$(t.currentTarget),o=e.closest("form"),i=o.find(".inspector-container");$.oc.inspector.manager.applyValuesFromContainer(i)&&e.request("onControllerSave").done(this.proxy(this.saveControllerDone))},o.prototype.saveControllerDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e)},o.prototype.updateDataRegistry=function(t){if(void 0!==t.builderResponseData.registryData){var e=t.builderResponseData.registryData;$.oc.builder.dataRegistry.set(e.pluginCode,"controller-urls",null,e.urls)}},o.prototype.getControllerList=function(){return $("#layout-side-panel form[data-content-id=controller] [data-control=filelist]")},$.oc.builder.entityControllers.controller=o}(window.jQuery),+function($){"use strict";void 0===$.oc.builder&&($.oc.builder={});var t=$.oc.foundation.base,e=t.prototype,o=function(){t.call(this),this.$masterTabs=null,this.masterTabsObj=null,this.hideStripeIndicatorProxy=null,this.entityControllers={},this.init()};o.prototype=Object.create(e),o.prototype.constructor=o,o.prototype.dispose=function(){e.dispose.call(this)},o.prototype.openOrLoadMasterTab=function(t,e,o,i){if(this.masterTabsObj.goTo(o))return!1;var r=void 0===i?{}:i;$.oc.stripeLoadIndicator.show();var n=t.request(e,{data:r}).done(this.proxy(this.addMasterTab)).always(this.hideStripeIndicatorProxy);return n},o.prototype.getMasterTabActivePane=function(){return this.$masterTabs.find("> .tab-content > .tab-pane.active")},o.prototype.unchangeTab=function(t){t.find("form").trigger("unchange.oc.changeMonitor")},o.prototype.triggerCommand=function(t,e){var o=t.split(":");if(2===o.length){var i=o[0],r=o[1];if(void 0===this.entityControllers[i])throw new Error("Unknown entity type: "+i);this.entityControllers[i].invokeCommand(r,e)}},o.prototype.init=function(){this.$masterTabs=$("#builder-master-tabs"),this.$sidePanel=$("#builder-side-panel"),this.masterTabsObj=this.$masterTabs.data("oc.tab"),this.hideStripeIndicatorProxy=this.proxy(this.hideStripeIndicator),new $.oc.tabFormExpandControls(this.$masterTabs),this.createEntityControllers(),this.registerHandlers()},o.prototype.createEntityControllers=function(){for(var t in $.oc.builder.entityControllers)"base"!=t&&(this.entityControllers[t]=new $.oc.builder.entityControllers[t](this))},o.prototype.registerHandlers=function(){$(document).on("click","[data-builder-command]",this.proxy(this.onCommand)),$(document).on("submit","[data-builder-command]",this.proxy(this.onCommand)),this.$masterTabs.on("changed.oc.changeMonitor",this.proxy(this.onFormChanged)),this.$masterTabs.on("unchanged.oc.changeMonitor",this.proxy(this.onFormUnchanged)),this.$masterTabs.on("shown.bs.tab",this.proxy(this.onTabShown)),this.$masterTabs.on("afterAllClosed.oc.tab",this.proxy(this.onAllTabsClosed)),this.$masterTabs.on("closed.oc.tab",this.proxy(this.onTabClosed)),this.$masterTabs.on("autocompleteitems.oc.inspector",this.proxy(this.onDataRegistryItems)),this.$masterTabs.on("dropdownoptions.oc.inspector",this.proxy(this.onDataRegistryItems));for(var t in this.entityControllers)void 0!==this.entityControllers[t].registerHandlers&&this.entityControllers[t].registerHandlers()},o.prototype.hideStripeIndicator=function(){$.oc.stripeLoadIndicator.hide()},o.prototype.addMasterTab=function(t){if(this.masterTabsObj.addTab(t.tabTitle,t.tab,t.tabId,"oc-"+t.tabIcon),t.isNewRecord){var e=this.getMasterTabActivePane();e.find("form").one("ready.oc.changeMonitor",this.proxy(this.onChangeMonitorReady))}},o.prototype.updateModifiedCounter=function(){var t={database:{menu:"database",count:0},models:{menu:"models",count:0},permissions:{menu:"permissions",count:0},menus:{menu:"menus",count:0},versions:{menu:"versions",count:0},localization:{menu:"localization",count:0},controller:{menu:"controllers",count:0}};$("> div.tab-content > div.tab-pane[data-modified] > form",this.$masterTabs).each(function(){var e=$(this).data("entity");t[e].count++}),$.each(t,function(t,e){$.oc.sideNav.setCounter("builder/"+e.menu,e.count)})},o.prototype.getFormPluginCode=function(t){var e=$(t).closest("form"),o=e.find('input[name="plugin_code"]'),i=o.val();if(!i)throw new Error("Plugin code input is not found in the form.");return i},o.prototype.setPageTitle=function(t){$.oc.layout.setPageTitle(t.length?t+" | ":t)},o.prototype.getFileLists=function(){return $("[data-control=filelist]",this.$sidePanel)},o.prototype.dataToInspectorArray=function(t){var e=[];for(var o in t){var i={title:t[o],value:o};e.push(i)}return e},o.prototype.onCommand=function(t){if("FORM"!=t.currentTarget.tagName||"click"!=t.type){var e=$(t.currentTarget).data("builderCommand");this.triggerCommand(e,t);var o=$(t.currentTarget);if("A"!==t.currentTarget.tagName||"menuitem"!=o.attr("role")||"javascript:;"!=o.attr("href"))return t.preventDefault(),!1}},o.prototype.onFormChanged=function(t){$(".form-tabless-fields",t.target).trigger("modified.oc.tab"),this.updateModifiedCounter()},o.prototype.onFormUnchanged=function(t){$(".form-tabless-fields",t.target).trigger("unmodified.oc.tab"),this.updateModifiedCounter()},o.prototype.onTabShown=function(t){var e=$(t.target).closest("[data-control=tab]");if(e.attr("id")==this.$masterTabs.attr("id")){var o=$(t.target).closest("li").attr("data-tab-id"),i=$(t.target).attr("title");i&&this.setPageTitle(i),this.getFileLists().fileList("markActive",o),$(window).trigger("resize")}},o.prototype.onAllTabsClosed=function(t){this.setPageTitle(""),this.getFileLists().fileList("markActive",null)},o.prototype.onTabClosed=function(t,e,o){$(o).find("form").off("ready.oc.changeMonitor",this.proxy(this.onChangeMonitorReady)),this.updateModifiedCounter()},o.prototype.onChangeMonitorReady=function(t){$(t.target).trigger("change")},o.prototype.onDataRegistryItems=function(t,e){var o=this;if("model-classes"==e.propertyDefinition.fillFrom||"model-forms"==e.propertyDefinition.fillFrom||"model-lists"==e.propertyDefinition.fillFrom||"controller-urls"==e.propertyDefinition.fillFrom||"model-columns"==e.propertyDefinition.fillFrom||"plugin-lists"==e.propertyDefinition.fillFrom||"permissions"==e.propertyDefinition.fillFrom){t.preventDefault();var i=null,r=e.propertyDefinition.subtypeFrom;void 0!==r&&(i=e.values[r]),$.oc.builder.dataRegistry.get($(t.target),this.getFormPluginCode(t.target),e.propertyDefinition.fillFrom,i,function(t){e.callback({options:o.dataToInspectorArray(t)})})}},$(document).ready(function(){$.oc.builder.indexController=new o})}(window.jQuery),+function($){"use strict";void 0===$.oc.builder&&($.oc.builder={});var t=$.oc.foundation.base,e=t.prototype,o=function(e,i,r){this.input=e,this.form=i,this.options=$.extend({},o.DEFAULTS,r),this.disposed=!1,this.initialized=!1,this.newStringPopupMarkup=null,t.call(this),this.init()};o.prototype=Object.create(e),o.prototype.constructor=o,o.prototype.dispose=function(){this.unregisterHandlers(),this.form=null,this.options.beforePopupShowCallback=null,this.options.afterPopupHideCallback=null,this.options=null,this.disposed=!0,this.newStringPopupMarkup=null,this.initialized&&$(this.input).autocomplete("destroy"),$(this.input).removeData("localization-input"),this.input=null,e.dispose.call(this)},o.prototype.init=function(){if(!this.options.plugin)throw new Error("The options.plugin value should be set in the localization input object.");var t=$(this.input);t.data("localization-input",this),t.attr("data-builder-localization-input","true"),t.attr("data-builder-localization-plugin",this.options.plugin),this.getContainer().addClass("localization-input-container"),this.registerHandlers(),this.loadDataAndBuild()},o.prototype.buildAddLink=function(){var t=this.getContainer();if(!(t.find("a.localization-trigger").length>0)){var e=document.createElement("a");e.setAttribute("class","oc-icon-plus localization-trigger"),e.setAttribute("href","#");var o=t.position();$(e).css({top:o.top+4,right:7}),t.append(e)}},o.prototype.loadDataAndBuild=function(){this.showLoadingIndicator();var t=$.oc.builder.dataRegistry.get(this.form,this.options.plugin,"localization",null,this.proxy(this.dataLoaded)),e=this;t&&t.always(function(){e.hideLoadingIndicator()})},o.prototype.reload=function(){$.oc.builder.dataRegistry.get(this.form,this.options.plugin,"localization",null,this.proxy(this.dataLoaded))},o.prototype.dataLoaded=function(t){if(!this.disposed){var e=$(this.input),o=e.data("autocomplete");if(o)o.source=this.preprocessData(t);else{this.hideLoadingIndicator();var i={source:this.preprocessData(t),matchWidth:!0};i=$.extend(i,this.options.autocompleteOptions),$(this.input).autocomplete(i),this.initialized=!0}}},o.prototype.preprocessData=function(t){var e=$.extend({},t);for(var o in e)e[o]=o+" - "+e[o];return e},o.prototype.getContainer=function(){return $(this.input).closest(".autocomplete-container")},o.prototype.showLoadingIndicator=function(){var t=this.getContainer();t.addClass("loading-indicator-container size-small"),t.loadIndicator()},o.prototype.hideLoadingIndicator=function(){var t=this.getContainer();t.loadIndicator("hide"),t.loadIndicator("destroy"),t.removeClass("loading-indicator-container")},o.prototype.loadAndShowPopup=function(){null===this.newStringPopupMarkup?($.oc.stripeLoadIndicator.show(),$(this.input).request("onLanguageLoadAddStringForm").done(this.proxy(this.popupMarkupLoaded)).always(function(){$.oc.stripeLoadIndicator.hide()})):this.showPopup()},o.prototype.popupMarkupLoaded=function(t){this.newStringPopupMarkup=t.markup,this.showPopup()},o.prototype.showPopup=function(){var t=$(this.input);t.popup({content:this.newStringPopupMarkup});var e=t.data("oc.popup").$content,o=e.find("#language_string_key");$.oc.builder.dataRegistry.get(this.form,this.options.plugin,"localization","sections",function(t){o.autocomplete({source:t,matchWidth:!0})}),e.find("form").on("submit",this.proxy(this.onSubmitPopupForm))},o.prototype.stringCreated=function(t){if(void 0===t.localizationData||void 0===t.registryData)throw new Error("Invalid server response.");var e=$(this.input);e.val(t.localizationData.key),$.oc.builder.dataRegistry.set(this.options.plugin,"localization",null,t.registryData.strings),$.oc.builder.dataRegistry.set(this.options.plugin,"localization","sections",t.registryData.sections),e.data("oc.popup").hide(),e.trigger("change")},o.prototype.onSubmitPopupForm=function(t){var e=$(t.target);return $.oc.stripeLoadIndicator.show(),e.request("onLanguageCreateString",{data:{plugin_code:this.options.plugin}}).done(this.proxy(this.stringCreated)).always(function(){$.oc.stripeLoadIndicator.hide()}),t.preventDefault(),!1},o.prototype.onPopupHidden=function(t,e,o){$(o).find("#language_string_key").autocomplete("destroy"),$(o).find("form").on("submit",this.proxy(this.onSubmitPopupForm)),this.options.afterPopupHideCallback&&this.options.afterPopupHideCallback()},o.updatePluginInputs=function(t){for(var e=document.body.querySelectorAll('input[data-builder-localization-input][data-builder-localization-plugin="'+t+'"]'),o=e.length-1;o>=0;o--)$(e[o]).data("localization-input").reload()},o.prototype.unregisterHandlers=function(){this.input.removeEventListener("focus",this.proxy(this.onInputFocus)),this.getContainer().off("click","a.localization-trigger",this.proxy(this.onTriggerClick)),$(this.input).off("hidden.oc.popup",this.proxy(this.onPopupHidden))},o.prototype.registerHandlers=function(){this.input.addEventListener("focus",this.proxy(this.onInputFocus)),this.getContainer().on("click","a.localization-trigger",this.proxy(this.onTriggerClick)),$(this.input).on("hidden.oc.popup",this.proxy(this.onPopupHidden))},o.prototype.onInputFocus=function(){this.buildAddLink()},o.prototype.onTriggerClick=function(t){return this.options.beforePopupShowCallback&&this.options.beforePopupShowCallback(),this.loadAndShowPopup(),t.preventDefault(),!1},o.DEFAULTS={plugin:null,autocompleteOptions:{},beforePopupShowCallback:null,afterPopupHideCallback:null},$.oc.builder.localizationInput=o}(window.jQuery),+function($){"use strict";var t=$.oc.inspector.propertyEditors.string,e=t.prototype,o=function(e,o,i,r){this.localizationInput=null,t.call(this,e,o,i,r)};o.prototype=Object.create(e),o.prototype.constructor=t,o.prototype.dispose=function(){this.removeLocalizationInput(),e.dispose.call(this)},o.prototype.build=function(){var t=document.createElement("div"),e=document.createElement("input"),o=void 0!==this.propertyDefinition.placeholder?this.propertyDefinition.placeholder:"",i=this.inspector.getPropertyValue(this.propertyDefinition.property);e.setAttribute("type","text"),e.setAttribute("class","string-editor"),e.setAttribute("placeholder",o),t.setAttribute("class","autocomplete-container"),void 0===i&&(i=this.propertyDefinition["default"]),void 0===i&&(i=""),e.value=i,$.oc.foundation.element.addClass(this.containerCell,"text autocomplete"),t.appendChild(e),this.containerCell.appendChild(t),this.buildLocalizationEditor()},o.prototype.buildLocalizationEditor=function(){this.localizationInput=new $.oc.builder.localizationInput(this.getInput(),this.getForm(),{plugin:this.getPluginCode(),beforePopupShowCallback:this.proxy(this.onPopupShown,this),afterPopupHideCallback:this.proxy(this.onPopupHidden,this)})},o.prototype.removeLocalizationInput=function(){this.localizationInput.dispose(),this.localizationInput=null},o.prototype.supportsExternalParameterEditor=function(){return!1},o.prototype.registerHandlers=function(){e.registerHandlers.call(this),$(this.getInput()).on("change",this.proxy(this.onInputKeyUp))},o.prototype.unregisterHandlers=function(){e.unregisterHandlers.call(this),$(this.getInput()).off("change",this.proxy(this.onInputKeyUp))},o.prototype.getForm=function(){var t=this.getRootSurface().getInspectableElement();if(!t)throw new Error("Cannot determine inspectable element in the Builder localization editor.");return $(t).closest("form")},o.prototype.getPluginCode=function(){var t=this.getForm(),e=t.find("input[name=plugin_code]");if(!e.length)throw new Error('The input "plugin_code" should be defined in the form in order to use the localization Inspector editor.');return e.val()},o.prototype.onPopupShown=function(){this.getRootSurface().popupDisplayed()},o.prototype.onPopupHidden=function(){this.getRootSurface().popupHidden()},$.oc.inspector.propertyEditors.builderLocalization=o}(window.jQuery),+function($){"use strict";if(void 0===$.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");if(void 0===$.oc.table.processor)throw new Error("The $.oc.table.processor namespace is not defined. Make sure that the table.processor.base.js script is loaded.");var t=$.oc.table.processor.string,e=t.prototype,o=function(e,o,i){this.localizationInput=null,this.popupDisplayed=!1,t.call(this,e,o,i)};o.prototype=Object.create(e),o.prototype.constructor=o,o.prototype.dispose=function(){this.removeLocalizationInput(),e.dispose.call(this)},o.prototype.onUnfocus=function(){this.activeCell&&!this.popupDisplayed&&(this.removeLocalizationInput(),e.onUnfocus.call(this))},o.prototype.onBeforePopupShow=function(){this.popupDisplayed=!0},o.prototype.onAfterPopupHide=function(){this.popupDisplayed=!1},o.prototype.renderCell=function(t,o){e.renderCell.call(this,t,o)},o.prototype.buildEditor=function(t,o,i){e.buildEditor.call(this,t,o,i),$.oc.foundation.element.addClass(o,"autocomplete-container"),this.buildLocalizationEditor()},o.prototype.buildLocalizationEditor=function(){var t=this.getInput();this.localizationInput=new $.oc.builder.localizationInput(t,$(t),{plugin:this.getPluginCode(t),beforePopupShowCallback:$.proxy(this.onBeforePopupShow,this),afterPopupHideCallback:$.proxy(this.onAfterPopupHide,this),autocompleteOptions:{menu:'<ul class="autocomplete dropdown-menu table-widget-autocomplete localization"></ul>',bodyContainer:!0}})},o.prototype.getInput=function(){return this.activeCell?this.activeCell.querySelector(".string-input"):null},o.prototype.getPluginCode=function(t){var e=$(t).closest("form"),o=e.find("input[name=plugin_code]");if(!o.length)throw new Error('The input "plugin_code" should be defined in the form in order to use the localization table processor.');return o.val()},o.prototype.removeLocalizationInput=function(){this.localizationInput&&(this.localizationInput.dispose(),this.localizationInput=null)},$.oc.table.processor.builderLocalization=o}(window.jQuery);